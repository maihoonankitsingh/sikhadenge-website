import React, { useMemo, useState } from "react";
import Image from "next/image";
import SiteLayout from "../components/SiteLayout";
import Head from "next/head";

type FormState = {
  name: string;
  email: string;
  phone: string;
  specialization: string;
  category: string;
  message: string;
};

export default function ContactPage() {
  const SPECIALIZATION_OPTIONS = useMemo(
    () => ["Graphic Design", "Video Editing", "Motion Graphics", "AI Tools"],
    []
  );

  const CATEGORY_OPTIONS = useMemo(
    () => ["Support", "Admissions", "Corporate / Workshop", "Instructor", "Hiring", "Influencer Collaboration"],
    []
  );

  const [form, setForm] = useState<FormState>({
    name: "",
    email: "",
    phone: "",
    specialization: "",
    category: "",
    message: "",
  });

  const [submitting, setSubmitting] = useState(false);
  const [done, setDone] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const phoneOk = /^\d{10}$/.test(form.phone.trim());

  const canSubmit =
    form.name.trim().length >= 2 &&
    form.email.trim().includes("@") &&
    phoneOk &&
    form.specialization.trim() &&
    form.category.trim() &&
    form.message.trim().length >= 5 &&
    !submitting;

  function onChange<K extends keyof FormState>(key: K, value: FormState[K]) {
    setForm((p) => ({ ...p, [key]: value }));
  }

  async function submit(e: React.FormEvent) {
    e.preventDefault();
    setError(null);
    setDone(false);

    if (!canSubmit) {
      setError("Please fill all required fields correctly.");
      return;
    }

    setSubmitting(true);
    try {
      const res = await fetch("/api/leads", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          fullName: form.name.trim(),
          phone: form.phone.trim(),
          email: form.email.trim(),
          source: "website-contact",
          notes: {
            page: "contact",
            specialization: form.specialization,
            category: form.category,
            message: form.message.trim(),
          },
        }),
      });

      if (!res.ok) {
        const t = await res.text().catch(() => "");
        throw new Error(t || "Request failed");
      }

      setDone(true);
      setForm({
        name: "",
        email: "",
        phone: "",
        specialization: "",
        category: "",
        message: "",
      });
    } catch (err: any) {
      setError(err?.message || "Something went wrong");
    } finally {
      setSubmitting(false);
    }
  }

  return (
   <SiteLayout>
     <Head>
        <title>Contact | Sikhadenge</title>
          <meta name="description" content="Contact Sikhadenge support." />
    </Head>
      <main className="bg-sd-base text-sd-text">
        {/* TOP SECTION */}
        <section className="mx-auto max-w-[1100px] px-4 py-10">
          <div className="grid gap-6 lg:grid-cols-2">
            {/* LEFT HERO */}
            <div className="sd-card relative overflow-hidden p-6">
              <Image
                src="/images/contact/contact-hero-student.webp"
                alt="Student learning online"
                width={1600}
                height={900}
                className="absolute inset-0 h-full w-full object-cover opacity-40"
                priority
              />
              <div className="absolute inset-0 bg-sd-base/70" />
              <div className="absolute inset-0 bg-[radial-gradient(circle_at_20%_20%,rgba(37,99,235,0.25),transparent_55%)]" />

              <div className="relative">
                <div className="text-xs font-semibold tracking-widest text-sd-blue uppercase">
                  NEED HELP?
                </div>

                <h1 className="mt-3 text-4xl font-extrabold leading-tight">
                  Write to <span className="text-sd-gold">Sikhadenge</span>
                </h1>

                <p className="mt-3 max-w-xl text-sd-secondary">
                  Share your query. Our team will respond on WhatsApp/call after review.
                </p>

                <div className="mt-6 grid gap-3">
                  <div className="sd-card flex items-center gap-3 p-4">
                    <div className="h-10 w-10 rounded-xl border border-white/10 bg-sd-base flex items-center justify-center">
                      <span className="text-sd-gold">‚òé</span>
                    </div>
                    <div>
                      <div className="text-sm font-semibold">Call</div>
                      <div className="text-sm text-sd-secondary">Support: +91 8808505573</div>
                    </div>
                  </div>

                  <div className="sd-card flex items-center gap-3 p-4">
                    <div className="h-10 w-10 rounded-xl border border-white/10 bg-sd-base flex items-center justify-center">
                      <span className="text-sd-gold">‚úâ</span>
                    </div>
                    <div>
                      <div className="text-sm font-semibold">Email</div>
                      <div className="text-sm text-sd-secondary">support@sikhadenge.in</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {/* RIGHT FORM */}
            <div className="sd-card p-6">
              <div className="text-lg font-extrabold">Contact Form</div>
              <div className="mt-1 text-sm text-sd-secondary">
                Fill this form and our team will review and respond.
              </div>

              <form className="mt-6 grid gap-4" onSubmit={submit}>
                <div>
                  <label className="text-xs font-semibold text-sd-secondary">Name *</label>
                  <input
                    className="sd-input mt-2"
                    value={form.name}
                    onChange={(e) => onChange("name", e.target.value)}
                    placeholder="Your name"
                    autoComplete="name"
                  />
                </div>

                <div>
                  <label className="text-xs font-semibold text-sd-secondary">Email *</label>
                  <input
                    className="sd-input mt-2"
                    value={form.email}
                    onChange={(e) => onChange("email", e.target.value)}
                    placeholder="you@example.com"
                    autoComplete="email"
                  />
                </div>

                <div>
                  <label className="text-xs font-semibold text-sd-secondary">Phone *</label>
                  <div className="mt-2 grid grid-cols-[90px_1fr] gap-2">
                    <div className="sd-input flex items-center justify-center text-sm text-sd-secondary">
                      IN +91
                    </div>
                    <input
                      className="sd-input"
                      value={form.phone}
                      onChange={(e) => onChange("phone", e.target.value.replace(/\D/g, "").slice(0, 10))}
                      placeholder="10-digit number"
                      inputMode="numeric"
                      autoComplete="tel"
                    />
                  </div>
                </div>

                <div>
                  <label className="text-xs font-semibold text-sd-secondary">Select Specialization *</label>
                  <select
                    className="sd-input mt-2"
                    value={form.specialization}
                    onChange={(e) => onChange("specialization", e.target.value)}
                  >
                    <option value="">Select specialization</option>
                    {SPECIALIZATION_OPTIONS.map((s) => (
                      <option key={s} value={s}>
                        {s}
                      </option>
                    ))}
                  </select>
                </div>

                <div>
                  <label className="text-xs font-semibold text-sd-secondary">Select Category *</label>
                  <select
                    className="sd-input mt-2"
                    value={form.category}
                    onChange={(e) => onChange("category", e.target.value)}
                  >
                    <option value="">Select category</option>
                    {CATEGORY_OPTIONS.map((c) => (
                      <option key={c} value={c}>
                        {c}
                      </option>
                    ))}
                  </select>
                </div>

                <div>
                  <label className="text-xs font-semibold text-sd-secondary">Your Message *</label>
                  <textarea
                    className="sd-input mt-2 min-h-[120px] resize-y"
                    value={form.message}
                    onChange={(e) => onChange("message", e.target.value)}
                    placeholder="Type your message"
                  />
                </div>

                {error && (
                  <div className="rounded-xl border border-red-500/20 bg-red-500/10 px-4 py-3 text-sm text-red-200">
                    {error}
                  </div>
                )}

                {done && (
                  <div className="rounded-xl border border-emerald-500/20 bg-emerald-500/10 px-4 py-3 text-sm text-emerald-200">
                    Submitted.
                  </div>
                )}

                <button className="sd-btn-primary w-full" type="submit" disabled={!canSubmit}>
                  Submit <span aria-hidden>‚Üí</span>
                </button>

                <div className="text-xs text-sd-muted">
                  By submitting, you agree to Sikhadenge&apos;s{" "}
                  <a className="underline text-sd-secondary hover:text-sd-text" href="/terms">
                    Terms
                  </a>{" "}
                  and{" "}
                  <a className="underline text-sd-secondary hover:text-sd-text" href="/privacy-policy">
                    Privacy Policy
                  </a>
                  .
                </div>
              </form>
    
        </div>
          </div>
        </section>

        {/* SECOND SECTION */}
        <section className="mx-auto max-w-[1100px] px-4 pb-14">
          <h2 className="text-2xl font-extrabold">Looking for something in particular?</h2>

          <div className="mt-6 sd-card overflow-hidden">
            <div className="grid gap-6 lg:grid-cols-2">
              <div className="relative min-h-[260px]">
                <Image
                  src="/images/contact/workshop-classroom.webp"
                  alt="Classroom workshop"
                  width={1600}
                  height={900}
                  className="absolute inset-0 h-full w-full object-cover opacity-45"
                />
                <div className="absolute inset-0 bg-sd-base/65" />
                <div className="absolute inset-0 bg-[radial-gradient(circle_at_70%_20%,rgba(37,99,235,0.22),transparent_55%)]" />
              </div>

              <div className="p-6">
                <div className="text-lg font-extrabold">Corporate workshop / college session</div>
                <p className="mt-2 text-sm text-sd-secondary">
                  For workshops, training sessions, or collaboration requests, use the Contact Form category
                  ‚ÄúCorporate / Workshop‚Äù.
                </p>

                <div className="mt-4 inline-flex items-center gap-2 rounded-xl border border-sd-blue/30 px-4 py-2 text-sm text-sd-text hover:shadow-glow-blue">
                  Learn more <span aria-hidden>‚Üí</span>
                </div>
              </div>
            </div>
          </div>

          <div className="mt-6 grid gap-4 md:grid-cols-3">
            <div className="sd-card p-6 hover:shadow-glow-blue transition">
              <div className="h-10 w-10 rounded-xl border border-white/10 bg-sd-base flex items-center justify-center text-sd-gold">
                üéì
              </div>
              <div className="mt-4 text-base font-extrabold">Become an instructor</div>
              <div className="mt-2 text-sm text-sd-secondary">Teaching / mentoring queries</div>
              <div className="mt-4 text-sm text-sd-secondary">‚Üí</div>
            </div>

            <div className="sd-card p-6 hover:shadow-glow-blue transition">
              <div className="h-10 w-10 rounded-xl border border-white/10 bg-sd-base flex items-center justify-center text-sd-blue">
                üë•
              </div>
              <div className="mt-4 text-base font-extrabold">Join our team</div>
              <div className="mt-2 text-sm text-sd-secondary">Hiring / openings</div>
              <div className="mt-4 text-sm text-sd-secondary">‚Üí</div>
            </div>

            <div className="sd-card p-6 hover:shadow-glow-blue transition">
              <div className="h-10 w-10 rounded-xl border border-white/10 bg-sd-base flex items-center justify-center text-sd-gold">
                üí¨
              </div>
              <div className="mt-4 text-base font-extrabold">Influencer collaboration</div>
              <div className="mt-2 text-sm text-sd-secondary">Partnership requests</div>
              <div className="mt-4 text-sm text-sd-secondary">‚Üí</div>
            </div>
          </div>

          <div className="mt-8 sd-card p-6">
            <div className="grid gap-6 lg:grid-cols-2">
              <div>
                <div className="text-2xl font-extrabold">Didn&apos;t find what you were looking for?</div>
                <div className="mt-2 text-sm text-sd-secondary">
                  Use the Contact Form and select the closest category.
                </div>
              </div>

              <div className="grid gap-3">
                <div className="sd-card flex items-center gap-3 p-4">
                  <div className="h-10 w-10 rounded-xl border border-white/10 bg-sd-base flex items-center justify-center">
                    <span className="text-sd-blue">‚òé</span>
                  </div>
                  <div>
                    <div className="text-sm font-semibold">Call</div>
                    <div className="text-sm text-sd-secondary">+91 8808505575 (Admissions)</div>
                    <div className="text-sm text-sd-secondary">+91 8808505573 (Support)</div>
                  </div>
                </div>

                <div className="sd-card flex items-center gap-3 p-4">
                  <div className="h-10 w-10 rounded-xl border border-white/10 bg-sd-base flex items-center justify-center">
                    <span className="text-sd-gold">‚úâ</span>
                  </div>
                  <div>
                    <div className="text-sm font-semibold">Email</div>
                    <div className="text-sm text-sd-secondary">support@sikhadenge.in</div>
                  </div>
                </div>
              </div>
            </div>

            <div className="mt-6 text-center text-xs text-sd-muted">
              Parent company: ThinkGrow Pvt Ltd.
            </div>
          </div>
        </section>
      </main>
    </SiteLayout>
  );
}

